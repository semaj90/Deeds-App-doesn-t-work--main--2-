import{ao as w,u as A,a6 as E,R as L,ap as x}from"./BYQKk6H6.js";import{i as T,a as k,p as H,b as M}from"./DwDGgwRq.js";function R(a,r,s){w(()=>{var n=A(()=>r(a,s?.())||{});if(s&&n?.update){var t=!1,o={};E(()=>{var e=s();L(e),t&&x(o,e)&&(o=e,n.update(e))}),t=!0}if(n?.destroy)return()=>n.destroy()})}function g(a){const r=JSON.parse(a);return r.data&&(r.data=H(r.data,M.decoders)),r}function u(a){return HTMLElement.prototype.cloneNode.call(a)}function S(a,r=()=>{}){const s=async({action:t,result:o,reset:e=!0,invalidateAll:c=!0})=>{o.type==="success"&&(e&&HTMLFormElement.prototype.reset.call(a),c&&await T()),(location.origin+location.pathname===t.origin+t.pathname||o.type==="redirect"||o.type==="error")&&await k(o)};async function n(t){if((t.submitter?.hasAttribute("formmethod")?t.submitter.formMethod:u(a).method)!=="post")return;t.preventDefault();const e=new URL(t.submitter?.hasAttribute("formaction")?t.submitter.formAction:u(a).action),c=t.submitter?.hasAttribute("formenctype")?t.submitter.formEnctype:u(a).enctype,p=new FormData(a),d=t.submitter?.getAttribute("name");d&&p.append(d,t.submitter?.getAttribute("value")??"");const m=new AbortController;let f=!1;const y=await r({action:e,cancel:()=>f=!0,controller:m,formData:p,formElement:a,submitter:t.submitter})??s;if(f)return;let l;try{const i=new Headers({accept:"application/json","x-sveltekit-action":"true"});c!=="multipart/form-data"&&i.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(c)?c:"application/x-www-form-urlencoded");const h=c==="multipart/form-data"?p:new URLSearchParams(p),b=await fetch(e,{method:"POST",headers:i,cache:"no-store",body:h,signal:m.signal});l=g(await b.text()),l.type==="error"&&(l.status=b.status)}catch(i){if(i?.name==="AbortError")return;l={type:"error",error:i}}await y({action:e,formData:p,formElement:a,update:i=>s({action:e,result:l,reset:i?.reset,invalidateAll:i?.invalidateAll}),result:l})}return HTMLFormElement.prototype.addEventListener.call(a,"submit",n),{destroy(){HTMLFormElement.prototype.removeEventListener.call(a,"submit",n)}}}export{R as a,S as e};
